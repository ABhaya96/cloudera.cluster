---

- name: Teardown Ranger policies (keyadmin)
  include_tasks: cluster_setup_ranger.yml
  run_once: true
  loop: "{{ definition.clusters }}"
  loop_control:
    loop_var: cluster
    label: "{{ cluster.name }}"
  vars:
    use_ranger_keyadmin: True
  when:
    - "'RANGER' in cluster.services | default([])"
    - cluster.security.hdfs_encryption | default(False)

- name: Teardown Ranger policies
  include_tasks: cluster_setup_ranger.yml
  run_once: true
  loop: "{{ definition.clusters }}"
  loop_control:
    loop_var: cluster
    label: "{{ cluster.name }}"
  when:
    - "'RANGER' in cluster.services | default([])"
